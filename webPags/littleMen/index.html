<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta content='littleMen - zhuzhan' name='title' />
  <meta content='littleMen - zhuzhan' name='og:title' />
  <meta name="description" content="littleMen - zhuzhan">
  <title>little men - 对ta说</title>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <meta content='text/html; charset=utf-8' http-equiv='content-type' />
  <link href="stylesheets/site/clear_default.css" rel="stylesheet" type="text/css" />
  <link href="stylesheets/site/up_style.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="stylesheets/fonts.css" media="screen" />
  <link rel="stylesheet" href="stylesheets/style.css" media="screen" />
  <script src='javascripts/jquery.js' type='text/javascript'></script>
  <script>
  $().ready (function () {
    $('a.bg-block, a.button-sharp, #save img').click (function (e) { $('#output, .sth').show (); });
    $('#words').keydown (function (e) { $('#output, .sth').show (); });
    $('.wrapper').click (function (e) { e.stopPropagation () });
  })
  </script>
  <script src='javascripts/jquery.scrollTo.min.js' type='text/javascript'></script>
  <script src='javascripts/modernizr.custom.js' type='text/javascript'></script>
  <script src='javascripts/binary.js' type='text/javascript'></script>
  <script src='javascripts/stuff.js' type='text/javascript'></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-21332781-13']);
    _gaq.push(['_trackPageview']);
  </script>
  <style type="text/css">
   #loading{
    display: none;
    font-size: 20px;
    line-height: 30px;
    color: #fff;
    text-align: center;
    padding-top: 30%;
    z-index: 2000;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,.8);
  }   
  </style>
</head>

<body>
<div id="auto_root_box">
    <div class="wrapper main" align="center">
      <h1 style="padding: 0;font-weight: 200;height:40px; margin: 20px 0;">你想对TA说
      </h1>
      <div>
        <textarea id="words" maxlength="40" style="width:75%" placeholder="写些想说的话，用空格、回车排列，限40字"></textarea>
      </div>
      <h3 data-lang="background_colors">选择背景颜色:</h3>
      <div style="margin-bottom: 10px;">
        <a data-color="#EA5415" class="bg-block"></a>
        <a data-color="#f49ec0" class="bg-block"></a>
        <a data-color="#f6f08b" class="bg-block"></a>
        <a data-color="#c1d540" class="bg-block"></a>
        <a data-color="#77cff0" class="bg-block"></a>
        <a data-color="#980c7e" class="bg-block"></a>
        <a data-color="#ffffff" class="bg-block"></a>
      </div>
      <div>
        <h3 class="inline">选择尺寸:</h3>
        <a class="button-sharp" data-size="facebook" data-lang="facebook_cover">长方形</a>
        <a class="button-sharp" data-size="square" data-lang="square">正方形</a>
      </div>
      <div id="save" class="inline" style="width:100%">
        <!-- <img src="materials/refresh.png" alt="refresh" /> -->
        <p class="button green" alt="refresh" >click - 生成</p>
      </div>
      <div id="pic">
        <img id="output" src="materials/bg.jpg" style="display: block;position:relative;z-index:1000"/>
      </div>
       <div>
          <p id="download" class="button-p green" data-lang="download_this_pic" >Ps：长按图片即可保存</p>
        </div>

      <div class="canvas_box" style="display:none">
        <canvas width="850" height="315" id="canvas-bg"></canvas>
        <canvas width="850" height="315" id="canvas-people"></canvas>
        <canvas width="850" height="315" id="canvas-text"></canvas>
        <canvas width="850" height="315" id="canvas-mark"></canvas>
      </div>
      <div id="loading">
        <p>正在生成图片，请稍等......</p>
      </div>
    </div>
  
</div>
<!--auto_root_box_end-->
<script type="text/javascript">
  var image = '';
function getImg(uri){
    image = uri;
    $('#output').attr('src',image);
}

$("textarea").change(function(){
  var text = $("textarea").val()
  dval(text)
})

function dval(str){
  var data = []
  var val = []
  var arr = str.split('\n')
  for(var i = 0; i < arr.length; i++){
    dealStr(arr[i])
  }
  function dealStr(s){
    var len = s.length
    var st = s
    var head
    var tail
    while(len >8){
      head = st.substring(0,8)
      tail = st.substring(8)
      data.push(head)
      data.push('\n')
      st = tail
      len = st.length
    }
    data.push(st)
    data.push('\n')
  }

  for(var j=0;j<data.length-1;j++){
    val = val + data[j]
  }
  console.log(val)
  $("textarea").val(val)
}
</script>
</body>
</html>
